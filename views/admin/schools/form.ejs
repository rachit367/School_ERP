<%- include('../partials/header') %>

    <div class="main-content">
        <%- include('../partials/topbar', { pageTitle: school ? 'Edit School' : 'Add New School' }) %>

            <div class="content-wrapper">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-building me-2"></i>
                                    <%= school ? 'Edit School' : 'Create New School' %>
                                </h5>
                            </div>
                            <div class="card-body">
                                <% if (typeof error !=='undefined' && error) { %>
                                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                        <i class="bi bi-exclamation-triangle me-2"></i>
                                        <%= error %>
                                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                    </div>
                                    <% } %>

                                        <form method="POST"
                                            action="<%= school ? `/admin/schools/${school._id}` : '/admin/schools' %>">
                                            <!-- School Information Section -->
                                            <div class="mb-4">
                                                <h6 class="text-primary border-bottom pb-2"><i
                                                        class="bi bi-building me-2"></i>School Information</h6>
                                            </div>

                                            <div class="mb-3">
                                                <label for="name" class="form-label">School Name <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="name" name="name"
                                                    value="<%= school ? school.name : '' %>" required
                                                    placeholder="Enter school name">
                                            </div>

                                            <div class="mb-4">
                                                <label for="address" class="form-label">Address</label>
                                                <textarea class="form-control" id="address" name="address" rows="3"
                                                    placeholder="Enter school address"><%= school ? school.address : '' %></textarea>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6 mb-3">
                                                    <label for="plan" class="form-label">Plan <span class="text-danger">*</span></label>
                                                    <select class="form-select" id="plan" name="plan" required>
                                                        <option value="Assist" <%= school && school.plan === 'Assist' ? 'selected' : (!school ? 'selected' : '') %>>Assist</option>
                                                        <option value="Autonomy" <%= school && school.plan === 'Autonomy' ? 'selected' : '' %>>Autonomy</option>
                                                        <option value="Automate" <%= school && school.plan === 'Automate' ? 'selected' : '' %>>Automate</option>
                                                    </select>
                                                    <small class="text-muted">Select the subscription plan for this school</small>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="logo" class="form-label">Logo URL</label>
                                                    <input type="url" class="form-control" id="logo" name="logo"
                                                        value="<%= school && school.logo ? school.logo : '' %>"
                                                        placeholder="https://example.com/logo.png">
                                                    <small class="text-muted">Optional - Enter a URL for the school logo</small>
                                                </div>
                                            </div>

                                            <% if (!school) { %>
                                                <!-- Principal Information Section (only for new schools) -->
                                                <div class="mb-4">
                                                    <h6 class="text-success border-bottom pb-2"><i
                                                            class="bi bi-person-badge me-2"></i>Principal Information
                                                    </h6>
                                                    <small class="text-muted">A principal will be created and linked to
                                                        this school</small>
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="principal_name" class="form-label">Principal Name
                                                            <span class="text-danger">*</span></label>
                                                        <input type="text" class="form-control" id="principal_name"
                                                            name="principal_name" required
                                                            placeholder="Enter principal's full name">
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="principal_phone" class="form-label">Phone Number
                                                            <span class="text-danger">*</span></label>
                                                        <input type="tel" class="form-control" id="principal_phone"
                                                            name="principal_phone" required
                                                            placeholder="10-digit phone number" pattern="[0-9]{10}">
                                                    </div>
                                                </div>

                                                <div class="mb-4">
                                                    <label for="principal_email" class="form-label">Email</label>
                                                    <input type="email" class="form-control" id="principal_email"
                                                        name="principal_email" placeholder="principal@school.com">
                                                </div>
                                                <% } %>

                                                    <div class="d-flex gap-2">
                                                        <button type="submit" class="btn btn-primary"><i
                                                                class="bi bi-check-circle me-2"></i>
                                                            <%= school ? 'Update School' : 'Create School & Principal'
                                                                %>
                                                        </button>
                                                        <a href="/admin/schools" class="btn btn-secondary"><i
                                                                class="bi bi-x-circle me-2"></i>Cancel</a>
                                                    </div>
                                        </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </div>

    <%- include('../partials/footer') %>