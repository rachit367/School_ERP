<!-- Topbar -->
<header class="topbar">
    <div class="topbar-left">
        <button class="btn btn-link d-lg-none p-0" id="sidebarToggle">
            <i class="bi bi-list fs-4 text-muted"></i>
        </button>
        <h1 class="topbar-title">
            <%= typeof pageTitle !=='undefined' ? pageTitle : 'Dashboard' %>
        </h1>
    </div>

    <div class="topbar-right">
        <!-- Theme Toggle -->
        <button class="theme-toggle" id="themeToggle" title="Toggle dark mode">
            <i class="bi bi-sun-fill icon-sun"></i>
            <i class="bi bi-moon-fill icon-moon"></i>
        </button>

        <a href="/admin/logout" class="btn btn-secondary btn-sm">
            <i class="bi bi-box-arrow-right"></i>
            <span class="d-none d-md-inline">Logout</span>
        </a>
    </div>
</header>

<script>
    // Theme Toggle Functionality
    document.addEventListener('DOMContentLoaded', function () {
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const iconSun = document.querySelector('.icon-sun');
        const iconMoon = document.querySelector('.icon-moon');

        // Use a safe fallback for local storage access
        let savedTheme = 'light';
        try {
            savedTheme = localStorage.getItem('gyanama-theme') || 'light';
        } catch (e) {
            console.error('Local storage access failed', e);
        }

        // Ensure attribute is set if not already present
        if (!html.hasAttribute('data-theme')) {
            html.setAttribute('data-theme', savedTheme);
        }

        if (themeToggle) {
            themeToggle.addEventListener('click', function (e) {
                e.preventDefault(); // Prevent any default button behavior

                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                html.setAttribute('data-theme', newTheme);
                try {
                    localStorage.setItem('gyanama-theme', newTheme);
                } catch (e) {
                    // Ignore local storage errors
                }

                // Optional: visual feedback or animation trigger if needed
                console.log('Theme toggled to:', newTheme);
            });
        } else {
            console.warn('Theme toggle button not found');
        }
    });

    // Global Search Shortcut handler removed
</script>